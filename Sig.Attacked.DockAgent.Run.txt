if [OWNER] == [Player]
	* for the player, this script should only be run on DockAgents
	if not [THIS]-> is script 'Cmd.DockAgent' on stack of task=0
		[THIS]-> set ship command/signal [SIGNAL_ATTACKED] to global default behaviour
		return null
	end
end

$AttackerName = $Attacker-> get name
$AttackerID = $Attacker-> get ID code
$AttackerSector = $Attacker-> get sector

$Amount = [THIS]-> get amount of ware {Fighter Drone} in cargo bay
= [THIS]-> launch $Amount fight drones: protect me or attack target=null
$Amount = [THIS]-> get amount of ware {Fighter Drone MKII} in cargo bay
= [THIS]-> launch $Amount fight drones: protect me or attack target=null

$Station = [THIS]-> call script 'Lib.Gen.GetSafeStationToDock' : Ship=[THIS] StartingJumps=2 ForJump=[TRUE] NotCurrentSector=[TRUE]
[THIS]-> set orders string sprintf: fmt= 'Fleeing to %s' , $Station , null , null , null , null

= [THIS]-> call script '!move.jumptostation' : station=$Station jumptoo=[TRUE]

play sample 1129
= wait 300 ms
play sample: incoming transmission [IncomingTransmission.Message], from object [THIS]
if [OWNER] == [Player]
	write to player logbook: printf: pageid=1500 textid=224, [THIS], $AttackerSector, $AttackerName, $AttackerID, $Station
end

= wait randomly from 2000 to 5000 ms

$Null = null
START $Null-> call script 'Lib.Gen.RunScriptWhenFinished' : ScriptName='Cmd.DockAgent' TaskWatch=null TaskRun=0 ObjectWatch=[THIS] ObjectRun=[THIS] arg1=null arg2=null arg3=null arg4=null arg5=null

return null

